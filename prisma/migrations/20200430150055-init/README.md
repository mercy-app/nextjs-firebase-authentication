# Migration `20200430150055-init`

This migration has been generated by I Chen Wu at 4/30/2020, 3:00:55 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "PlatformType" AS ENUM ('ECOMMERCE', 'BOOKING_HR', 'BOOKING_DATE');

CREATE TYPE "Status" AS ENUM ('PENDING', 'PAID', 'COMPLETED');

CREATE TABLE "public"."Country" (
    "code" integer  NOT NULL ,
    "currency" text  NOT NULL ,
    "id" text  NOT NULL ,
    "name" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Staff" (
    "companyId" text  NOT NULL ,
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "role" text  NOT NULL ,
    "userId" text  NOT NULL ,
    PRIMARY KEY ("companyId","userId")
) 

CREATE TABLE "public"."Address" (
    "companyId" text   ,
    "id" text  NOT NULL ,
    "info" text  NOT NULL ,
    "json" text   ,
    "name" text  NOT NULL ,
    "type" text  NOT NULL ,
    "userId" text   ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Card" (
    "cardType" text  NOT NULL ,
    "id" text  NOT NULL ,
    "lastFourDigit" integer  NOT NULL ,
    "name" text  NOT NULL ,
    "type" text  NOT NULL ,
    "userId" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Contact" (
    "companyId" text   ,
    "id" text  NOT NULL ,
    "number" text  NOT NULL ,
    "type" text  NOT NULL ,
    "userId" text   ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Customer" (
    "companyId" text  NOT NULL ,
    "totalOrder" integer  NOT NULL ,
    "totalOrderAmount" integer  NOT NULL ,
    "userId" text  NOT NULL ,
    PRIMARY KEY ("companyId","userId")
) 

CREATE TABLE "public"."ProductsOnCounpon" (
    "couponId" text  NOT NULL ,
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "productId" text  NOT NULL ,
    PRIMARY KEY ("productId","couponId")
) 

CREATE TABLE "public"."Coupon" (
    "code" text  NOT NULL ,
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "discountInPercent" integer  NOT NULL ,
    "expirationDate" timestamp(3)  NOT NULL ,
    "id" text  NOT NULL ,
    "numberOfCoupon" integer  NOT NULL ,
    "numberOfUnusedCoupon" integer  NOT NULL ,
    "status" text  NOT NULL ,
    "title" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."User" (
    "email" text  NOT NULL ,
    "id" text  NOT NULL ,
    "name" text   
) 

CREATE TABLE "public"."Company" (
    "countryId" text   ,
    "customerId" text   ,
    "description" text  NOT NULL ,
    "id" text  NOT NULL ,
    "name" text  NOT NULL ,
    "ownerId" text   ,
    "platformId" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Post" (
    "authorId" text   ,
    "content" text   ,
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "id" text  NOT NULL ,
    "published" boolean  NOT NULL ,
    "title" text  NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Product" (
    "companyId" text  NOT NULL ,
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "description" text   ,
    "discountInPercent" integer   ,
    "id" text  NOT NULL ,
    "image" text  NOT NULL ,
    "platformId" text  NOT NULL ,
    "price" Decimal(65,30)   ,
    "published" boolean  NOT NULL ,
    "salePrice" Decimal(65,30)   ,
    "slug" text  NOT NULL ,
    "title" text  NOT NULL ,
    "type" text  NOT NULL ,
    "unit" text   ,
    "updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Category" (
    "categoryId" text   ,
    "icon" text  NOT NULL ,
    "id" text  NOT NULL ,
    "name" text  NOT NULL ,
    "platformId" text  NOT NULL ,
    "slug" text  NOT NULL ,
    "type" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Tag" (
    "id" text  NOT NULL ,
    "name" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."CategoriesOnPosts" (
    "categoryId" text  NOT NULL ,
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "postId" text  NOT NULL ,
    PRIMARY KEY ("postId","categoryId")
) 

CREATE TABLE "public"."CategoriesOnProducts" (
    "categoryId" text  NOT NULL ,
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "productId" text  NOT NULL ,
    PRIMARY KEY ("productId","categoryId")
) 

CREATE TABLE "public"."TagsOnProducts" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "productId" text  NOT NULL ,
    "tagId" text  NOT NULL ,
    PRIMARY KEY ("productId","tagId")
) 

CREATE TABLE "public"."TagsOnPosts" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "postId" text  NOT NULL ,
    "tagId" text  NOT NULL ,
    PRIMARY KEY ("postId","tagId")
) 

CREATE TABLE "public"."Platform" (
    "bannerImg" text  NOT NULL ,
    "content" text   ,
    "countryId" text  NOT NULL ,
    "icon" text  NOT NULL ,
    "id" text  NOT NULL ,
    "intlId" text  NOT NULL ,
    "label" text  NOT NULL ,
    "link" text  NOT NULL ,
    "platformType" text  NOT NULL ,
    "title" text  NOT NULL ,
    "typeSlug" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Room" (
    "capacity" integer  NOT NULL ,
    "id" text  NOT NULL ,
    "name" text  NOT NULL ,
    "productId" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Booking" (
    "bookingEnd" timestamp(3)  NOT NULL ,
    "bookingStart" timestamp(3)  NOT NULL ,
    "duration" integer  NOT NULL ,
    "id" text  NOT NULL ,
    "recurring" text []  ,
    "roomId" text  NOT NULL ,
    "startHour" integer  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Order" (
    "amount" Decimal(65,30)  NOT NULL ,
    "companyId" text  NOT NULL ,
    "contactNumber" text  NOT NULL ,
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "deliveryAddress" text  NOT NULL ,
    "deliveryFee" Decimal(65,30)  NOT NULL ,
    "deliveryTime" timestamp(3)  NOT NULL ,
    "discount" Decimal(65,30)  NOT NULL ,
    "id" text  NOT NULL ,
    "paymentMethod" text  NOT NULL ,
    "status" "Status" NOT NULL ,
    "subtotal" Decimal(65,30)  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."OrderItem" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "orderId" text  NOT NULL ,
    "productId" text  NOT NULL ,
    PRIMARY KEY ("productId","orderId")
) 

CREATE UNIQUE INDEX "Country.code" ON "public"."Country"("code")

CREATE UNIQUE INDEX "Address_companyId" ON "public"."Address"("companyId")

CREATE UNIQUE INDEX "Contact_companyId" ON "public"."Contact"("companyId")

CREATE UNIQUE INDEX "User.id" ON "public"."User"("id")

CREATE UNIQUE INDEX "User.email" ON "public"."User"("email")

CREATE UNIQUE INDEX "Product.slug" ON "public"."Product"("slug")

CREATE UNIQUE INDEX "Category.slug" ON "public"."Category"("slug")

CREATE UNIQUE INDEX "Platform.typeSlug" ON "public"."Platform"("typeSlug")

ALTER TABLE "public"."Staff" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Staff" ADD FOREIGN KEY ("companyId")REFERENCES "public"."Company"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Address" ADD FOREIGN KEY ("companyId")REFERENCES "public"."Company"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Address" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Card" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Contact" ADD FOREIGN KEY ("companyId")REFERENCES "public"."Company"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Contact" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Customer" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Customer" ADD FOREIGN KEY ("companyId")REFERENCES "public"."Company"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."ProductsOnCounpon" ADD FOREIGN KEY ("productId")REFERENCES "public"."Product"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."ProductsOnCounpon" ADD FOREIGN KEY ("couponId")REFERENCES "public"."Coupon"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Company" ADD FOREIGN KEY ("platformId")REFERENCES "public"."Platform"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Company" ADD FOREIGN KEY ("ownerId")REFERENCES "public"."User"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Company" ADD FOREIGN KEY ("countryId")REFERENCES "public"."Country"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Post" ADD FOREIGN KEY ("authorId")REFERENCES "public"."User"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Product" ADD FOREIGN KEY ("companyId")REFERENCES "public"."Company"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Product" ADD FOREIGN KEY ("platformId")REFERENCES "public"."Platform"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Category" ADD FOREIGN KEY ("categoryId")REFERENCES "public"."Category"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Category" ADD FOREIGN KEY ("platformId")REFERENCES "public"."Platform"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."CategoriesOnPosts" ADD FOREIGN KEY ("postId")REFERENCES "public"."Post"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."CategoriesOnPosts" ADD FOREIGN KEY ("categoryId")REFERENCES "public"."Category"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."CategoriesOnProducts" ADD FOREIGN KEY ("productId")REFERENCES "public"."Product"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."CategoriesOnProducts" ADD FOREIGN KEY ("categoryId")REFERENCES "public"."Category"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."TagsOnProducts" ADD FOREIGN KEY ("productId")REFERENCES "public"."Product"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."TagsOnProducts" ADD FOREIGN KEY ("tagId")REFERENCES "public"."Tag"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."TagsOnPosts" ADD FOREIGN KEY ("postId")REFERENCES "public"."Post"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."TagsOnPosts" ADD FOREIGN KEY ("tagId")REFERENCES "public"."Tag"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Platform" ADD FOREIGN KEY ("countryId")REFERENCES "public"."Country"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Room" ADD FOREIGN KEY ("productId")REFERENCES "public"."Product"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Booking" ADD FOREIGN KEY ("roomId")REFERENCES "public"."Room"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Order" ADD FOREIGN KEY ("companyId")REFERENCES "public"."Company"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."OrderItem" ADD FOREIGN KEY ("productId")REFERENCES "public"."Product"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."OrderItem" ADD FOREIGN KEY ("orderId")REFERENCES "public"."Order"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200430150055-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,312 @@
+datasource db {
+  provider = "postgresql"
+  url      = "postgres://postgres:postgres@localhost:5432/mercy"
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+generator typegraphql {
+  provider = "node_modules/typegraphql-prisma/generator.js"
+  output   = "../src/prisma/generated/type-graphql"
+}
+
+model Country {
+  id       String @default(cuid()) @id
+  code     Int    @unique
+  name     String
+  currency String
+}
+
+model Staff {
+  user      User     @relation(fields: [userId], references: [id])
+  userId    String
+  company   Company  @relation(fields: [companyId], references: [id])
+  companyId String
+  role      String
+  createdAt DateTime @default(now())
+
+  @@id([companyId, userId])
+}
+
+model Address {
+  id        String   @default(cuid()) @id
+  type      String
+  name      String
+  json      String?
+  info      String
+  companyId String?
+  company   Company? @relation(fields: [companyId], references: [id])
+  userId    String?
+  user      User?    @relation(fields: [userId], references: [id])
+}
+
+model Card {
+  id            String @default(cuid()) @id
+  type          String
+  cardType      String
+  name          String
+  lastFourDigit Int
+  userId        String
+  user          User   @relation(fields: [userId], references: [id])
+}
+
+model Contact {
+  id        String   @default(cuid()) @id
+  type      String
+  number    String
+  companyId String?
+  company   Company? @relation(fields: [companyId], references: [id])
+  userId    String?
+  user      User?    @relation(fields: [userId], references: [id])
+}
+
+model Customer {
+  userId           String
+  user             User    @relation(fields: [userId], references: [id])
+  companyId        String
+  company          Company @relation(fields: [companyId], references: [id])
+  totalOrder       Int
+  totalOrderAmount Int
+
+  @@id([companyId, userId])
+}
+
+model ProductsOnCounpon {
+  product   Product  @relation(fields: [productId], references: [id])
+  // relation scalar field (used in the `@relation` attribute above)
+  productId String
+  coupon    Coupon   @relation(fields: [couponId], references: [id])
+  // relation scalar field (used in the `@relation` attribute above)
+  couponId  String
+  createdAt DateTime @default(now())
+
+  @@id([productId, couponId])
+}
+
+model Coupon {
+  id                   String              @default(cuid()) @id
+  title                String
+  code                 String
+  discountInPercent    Int
+  numberOfCoupon       Int
+  numberOfUnusedCoupon Int
+  status               String
+  expirationDate       DateTime
+  createdAt            DateTime            @default(now())
+  products             ProductsOnCounpon[]
+}
+
+model User {
+  id        String    @unique
+  email     String    @unique
+  name      String?
+  posts     Post[]
+  companies Company[]
+  addresses Address[]
+  cards     Card[]
+  contacts  Contact[]
+}
+
+model Company {
+  id          String     @default(cuid()) @id
+  name        String
+  description String
+  address     Address
+  contact     Contact
+  ownerId     String?
+  platformId  String
+  platform    Platform   @relation(fields: [platformId], references: [id])
+  owner       User?      @relation(fields: [ownerId], references: [id])
+  countryId   String?
+  country     Country?   @relation(fields: [countryId], references: [id])
+  products    Product[]
+  customerId  String?
+  staffs      Staff[]
+  customers   Customer[]
+}
+
+model Post {
+  id         String              @default(cuid()) @id
+  createdAt  DateTime            @default(now())
+  updatedAt  DateTime            @updatedAt
+  published  Boolean
+  title      String
+  content    String?
+  author     User?               @relation(fields: [authorId], references: [id])
+  authorId   String?
+  categories CategoriesOnPosts[]
+  tags       TagsOnPosts[]
+}
+
+model Product {
+  id                String                 @default(cuid()) @id
+  createdAt         DateTime               @default(now())
+  updatedAt         DateTime               @updatedAt
+  published         Boolean
+  title             String
+  company           Company                @relation(fields: [companyId], references: [id])
+  companyId         String
+  categories        CategoriesOnProducts[]
+  price             Float?
+  platform          Platform               @relation(fields: [platformId], references: [id])
+  platformId        String
+  tags              TagsOnProducts[]
+  orders            OrderItem[]
+  slug              String                 @unique
+  unit              String?
+  salePrice         Float?
+  discountInPercent Int?
+  description       String?
+  type              String
+  image             String
+}
+
+model Category {
+  id         String                 @default(cuid()) @id
+  name       String
+  slug       String                 @unique
+  type       String
+  icon       String
+  categoryId String?
+  parent     Category?              @relation("ParentCategories", fields: [categoryId], references: [id])
+  children   Category[]             @relation("ParentCategories")
+  posts      CategoriesOnPosts[]
+  products   CategoriesOnProducts[]
+  platformId String
+  platform   Platform               @relation(fields: [platformId], references: [id])
+}
+
+model Tag {
+  id       String           @default(cuid()) @id
+  name     String
+  posts    TagsOnPosts[]
+  products TagsOnProducts[]
+}
+
+model CategoriesOnPosts {
+  post       Post     @relation(fields: [postId], references: [id])
+  // relation scalar field (used in the `@relation` attribute above)
+  postId     String
+  category   Category @relation(fields: [categoryId], references: [id])
+  // relation scalar field (used in the `@relation` attribute above)
+  categoryId String
+  createdAt  DateTime @default(now())
+
+  @@id([postId, categoryId])
+}
+
+model CategoriesOnProducts {
+  product    Product  @relation(fields: [productId], references: [id])
+  // relation scalar field (used in the `@relation` attribute above)
+  productId  String
+  category   Category @relation(fields: [categoryId], references: [id])
+  // relation scalar field (used in the `@relation` attribute above)
+  categoryId String
+  createdAt  DateTime @default(now())
+
+  @@id([productId, categoryId])
+}
+
+model TagsOnProducts {
+  product   Product  @relation(fields: [productId], references: [id])
+  // relation scalar field (used in the `@relation` attribute above)
+  productId String
+  tag       Tag      @relation(fields: [tagId], references: [id])
+  // relation scalar field (used in the `@relation` attribute above)
+  tagId     String
+  createdAt DateTime @default(now())
+
+  @@id([productId, tagId])
+}
+
+model TagsOnPosts {
+  post      Post     @relation(fields: [postId], references: [id])
+  // relation scalar field (used in the `@relation` attribute above)
+  postId    String
+  tag       Tag      @relation(fields: [tagId], references: [id])
+  // relation scalar field (used in the `@relation` attribute above)
+  tagId     String
+  createdAt DateTime @default(now())
+
+  @@id([postId, tagId])
+}
+
+enum PlatformType {
+  ECOMMERCE
+  BOOKING_HR
+  BOOKING_DATE
+}
+
+model Platform {
+  id           String     @default(cuid()) @id
+  title        String
+  link         String
+  label        String
+  icon         String
+  intlId       String
+  bannerImg    String
+  typeSlug     String     @unique
+  content      String?
+  products     Product[]
+  categories   Category[]
+  platformType String
+  countryId    String
+  country      Country    @relation(fields: [countryId], references: [id])
+}
+
+model Room {
+  id        String    @default(cuid()) @id
+  capacity  Int
+  name      String
+  productId String
+  product   Product   @relation(fields: [productId], references: [id])
+  bookings  Booking[]
+}
+
+model Booking {
+  id           String   @default(cuid()) @id
+  bookingStart DateTime
+  bookingEnd   DateTime
+  startHour    Int
+  duration     Int
+  recurring    String[]
+  roomId       String
+  room         Room     @relation(fields: [roomId], references: [id])
+}
+
+enum Status {
+  PENDING
+  PAID
+  COMPLETED
+}
+
+model Order {
+  id              String      @default(cuid()) @id
+  status          Status
+  amount          Float
+  products        OrderItem[]
+  companyId       String
+  company         Company     @relation(fields: [companyId], references: [id])
+  deliveryTime    DateTime
+  createdAt       DateTime    @default(now())
+  paymentMethod   String
+  deliveryAddress String
+  contactNumber   String
+  subtotal        Float
+  discount        Float
+  deliveryFee     Float
+}
+
+model OrderItem {
+  product   Product  @relation(fields: [productId], references: [id])
+  // relation scalar field (used in the `@relation` attribute above)
+  productId String
+  order     Order    @relation(fields: [orderId], references: [id])
+  // relation scalar field (used in the `@relation` attribute above)
+  orderId   String
+  createdAt DateTime @default(now())
+
+  @@id([productId, orderId])
+}
```


